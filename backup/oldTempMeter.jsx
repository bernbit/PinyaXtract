import React, { useEffect } from "react";
import Svg, { Path, Mask, G, Rect } from "react-native-svg";
import Helpers from "@/constants/Helpers-Constant";
import Animated, {
  useSharedValue,
  useAnimatedProps,
  withTiming,
  Easing,
} from "react-native-reanimated";
import useGlobal from "@/context/GlobalContext";

function TempMeter({ width = 114, height = 68 }) {
  const { tempValue } = useGlobal();

  const meterWidthFinal = Helpers.getRangeValue(tempValue, 1, 80, 1, 96);

  const meterWidth = useSharedValue(0);
  const Meter = Animated.createAnimatedComponent(Rect);

  useEffect(() => {
    meterWidth.value = withTiming(meterWidthFinal, {
      duration: 1000,
      easing: Easing.inOut(Easing.ease),
    });
  }, [meterWidthFinal]);

  const meterAnimation = useAnimatedProps(() => ({
    width: meterWidth.value,
  }));

  return (
    <Svg
      width={width}
      height={height}
      viewBox="0 0 114 68"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      // style={{ transform: [{ rotate: "90deg" }] }}
    >
      <Path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M113.964 9.94v48.12c0 4.41-3.504 8.027-7.777 8.027H7.856c-4.316 0-7.82-3.617-7.82-8.028V9.94c0-4.41 3.504-8.027 7.82-8.027h98.331c4.273 0 7.777 3.617 7.777 8.027z"
        fill="#383838"
      />
      <Path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M110.845 58.06V9.94c0-2.646-2.094-4.807-4.658-4.807H7.856c-2.564 0-4.658 2.161-4.658 4.807v48.12c0 2.602 2.094 4.807 4.658 4.807h98.331c2.564 0 4.658-2.205 4.658-4.807z"
        fill="#2B2B2B"
      />
      <Path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M104.776 33.978c0 1.72-1.324 3.087-2.991 3.087h-75.98c-1.197 3.352-4.317 5.734-7.992 5.734-4.701 0-8.547-3.925-8.547-8.821 0-4.852 3.846-8.777 8.547-8.777 3.675 0 6.795 2.382 7.991 5.734h75.981c1.667 0 2.991 1.367 2.991 3.043z"
        fill={`${tempValue >= 70 ? "#CC0000" : "#26C242"}`}
      />
      <Mask
        id="a"
        style={{
          maskType: "alpha",
        }}
        maskUnits="userSpaceOnUse"
        x={9}
        y={25}
        width={96}
        height={18}
      >
        <Path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M104.776 33.978c0 1.72-1.324 3.087-2.991 3.087h-75.98c-1.197 3.352-4.317 5.734-7.992 5.734-4.701 0-8.547-3.925-8.547-8.821 0-4.852 3.846-8.777 8.547-8.777 3.675 0 6.795 2.382 7.991 5.734h75.981c1.667 0 2.991 1.367 2.991 3.043z"
          fill="#26C242"
        />
      </Mask>
      <G mask="url(#a)">
        <Meter
          animatedProps={meterAnimation}
          width={meterWidthFinal}
          height="25"
          transform={`translate(9,23)`}
          fill={`${tempValue >= 70 ? "#FF0000" : "#30F353"}`}
        />
      </G>
      <Path
        fillRule="evenodd"
        clipRule="evenodd"
        d="M22.13 38.477c0 1.323-1.027 2.381-2.309 2.381-1.282 0-2.35-1.058-2.35-2.381 0-1.323 1.069-2.426 2.35-2.426 1.282 0 2.308 1.102 2.308 2.425zM88.324 13.557v9.483c0 .75-.598 1.323-1.325 1.323-.683 0-1.282-.573-1.282-1.323v-9.483c0-.706.599-1.323 1.282-1.323.727 0 1.325.617 1.325 1.323zm-11.025 0v9.483c0 .75-.599 1.323-1.282 1.323a1.315 1.315 0 01-1.325-1.323v-9.483c0-.706.598-1.323 1.325-1.323.684 0 1.282.617 1.282 1.323zm-11.026 0v9.483c0 .75-.598 1.323-1.282 1.323a1.315 1.315 0 01-1.324-1.323v-9.483c0-.706.598-1.323 1.324-1.323.684 0 1.282.617 1.282 1.323zm-11.025 0v9.483c0 .75-.598 1.323-1.282 1.323a1.315 1.315 0 01-1.325-1.323v-9.483c0-.706.599-1.323 1.325-1.323.684 0 1.282.617 1.282 1.323zm-11.025 0v9.483c0 .75-.599 1.323-1.282 1.323-.727 0-1.282-.573-1.282-1.323v-9.483c0-.706.555-1.323 1.282-1.323.683 0 1.282.617 1.282 1.323zm-11.026 0v9.483c0 .75-.555 1.323-1.282 1.323-.726 0-1.282-.573-1.282-1.323v-9.483c0-.706.556-1.323 1.282-1.323.727 0 1.282.617 1.282 1.323zm66.153 0v9.483c0 .75-.599 1.323-1.325 1.323-.684 0-1.282-.573-1.282-1.323v-9.483c0-.706.598-1.323 1.282-1.323.726 0 1.325.617 1.325 1.323zM88.324 44.96v9.483c0 .706-.598 1.323-1.325 1.323-.683 0-1.282-.617-1.282-1.323V44.96c0-.75.599-1.323 1.282-1.323.727 0 1.325.573 1.325 1.323zm-11.025 0v9.483c0 .706-.599 1.323-1.282 1.323a1.343 1.343 0 01-1.325-1.323V44.96c0-.75.598-1.323 1.325-1.323.684 0 1.282.573 1.282 1.323zm-11.026 0v9.483c0 .706-.598 1.323-1.282 1.323a1.344 1.344 0 01-1.324-1.323V44.96c0-.75.598-1.323 1.324-1.323.684 0 1.282.573 1.282 1.323zm-11.025 0v9.483c0 .706-.598 1.323-1.282 1.323a1.343 1.343 0 01-1.325-1.323V44.96c0-.75.599-1.323 1.325-1.323.684 0 1.282.573 1.282 1.323zm-11.025 0v9.483c0 .706-.599 1.323-1.282 1.323-.727 0-1.282-.617-1.282-1.323V44.96c0-.75.555-1.323 1.282-1.323.683 0 1.282.573 1.282 1.323zm-11.026 0v9.483c0 .706-.555 1.323-1.282 1.323-.726 0-1.282-.617-1.282-1.323V44.96c0-.75.556-1.323 1.282-1.323.727 0 1.282.573 1.282 1.323zm66.153 0v9.483c0 .706-.599 1.323-1.325 1.323-.684 0-1.282-.617-1.282-1.323V44.96c0-.75.598-1.323 1.282-1.323.726 0 1.325.573 1.325 1.323z"
        fill="#FEFEFE"
      />
    </Svg>
  );
}

export default TempMeter;
