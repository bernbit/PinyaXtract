import React, { useEffect, useState } from "react";
import Svg, { G, Path, Ellipse, Defs, ClipPath, Rect } from "react-native-svg";
import Animated, {
  useSharedValue,
  useAnimatedProps,
  withRepeat,
  withTiming,
} from "react-native-reanimated";
import useGlobal from "@/context/GlobalContext";
const Heater = ({ width = 222, height = 275 }) => {
  const { heaterState, setHeaterState, toggleHeaterState } = useGlobal();

  const heaterRotation = useSharedValue(0);
  const airPosition = useSharedValue(0);
  const Heater = Animated.createAnimatedComponent(Path);
  const Air = Animated.createAnimatedComponent(G);

  //* useEffect for Animation
  useEffect(() => {
    const animationSpeed = heaterState === "low" ? 1000 : 700;

    if (heaterState !== "off") {
      heaterRotation.value = 0;
      heaterRotation.value = withRepeat(
        withTiming(360, { duration: animationSpeed }),
        -1,
        false,
      );

      airPosition.value = 0;
      airPosition.value = withRepeat(
        withTiming(60, { duration: animationSpeed }),
        -1,
        true,
      );
    } else {
      heaterRotation.value = withTiming(0, { duration: 500 });
      airPosition.value = withTiming(0, { duration: 500 });
    }
  }, [heaterState]);

  //* Functions

  const heaterAnimation = useAnimatedProps(() => ({
    transform: [
      { translateX: 107.442 }, // Move pivot point to the origin
      { translateY: 167.96 },
      { rotate: `${heaterRotation.value}deg` }, // Rotate the gear
      { translateX: -107.442 }, // Move pivot point back to its original position
      { translateY: -167.96 },
    ],
  }));

  const airAnimation = useAnimatedProps(() => ({
    transform: [{ translateY: airPosition.value }],
  }));

  return (
    <Svg
      width={width}
      height={height}
      viewBox="0 0 222 275"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      onPress={toggleHeaterState}
      onLongPress={() => setHeaterState("off")}
    >
      <G clipPath="url(#clip0_282_303)">
        <Path
          d="M214.853 275H7.14701C3.19958 275 0 270.368 0 264.654V71.1018C0 65.3875 3.19958 60.7558 7.14701 60.7558H214.853C218.8 60.7558 222 65.3875 222 71.1018V264.655C222 270.368 218.8 275 214.853 275Z"
          fill="#30F353"
        />
        <Path
          d="M214.853 60.7558H212.47V243.963C212.47 253.486 207.137 261.206 200.559 261.206H0V264.655C0 270.368 3.19957 275 7.147 275H214.853C218.8 275 222 270.368 222 264.654V71.1018C222 65.3875 218.8 60.7558 214.853 60.7558Z"
          fill="#26C242"
        />
        <Ellipse
          cx={107.106}
          cy={167.626}
          rx={86.2894}
          ry={85.966}
          fill="#2B2B2B"
        />

        {/* Heater Wheel */}
        <Heater
          animatedProps={heaterAnimation}
          transform="rotate(0, 107.442, 167.960)"
          d="M121.393 83.4548C117.688 82.8477 113.904 82.4767 110.055 82.3572C119.169 107.085 118.051 133.885 106.978 157.621C91.2265 135.054 67.8673 119.489 40.9791 113.582C38.5706 116.503 36.3535 119.586 34.3453 122.812C60.3863 127.334 83.122 141.728 98.2259 163.18C70.7475 165.469 45.5607 177.836 27.0092 198.093C28.3582 201.658 29.9387 205.11 31.7327 208.43C48.6561 188.218 72.5101 175.807 98.69 173.519C86.9693 198.378 85.1484 226.308 93.4919 252.465C97.1969 253.072 100.981 253.443 104.83 253.563C95.716 228.835 96.8344 202.035 107.907 178.299C123.659 200.867 147.017 216.431 173.906 222.338C176.314 219.417 178.532 216.334 180.54 213.108C154.499 208.586 131.763 194.192 116.659 172.74C144.137 170.451 169.324 158.084 187.875 137.827C186.526 134.262 184.946 130.81 183.152 127.49C166.228 147.702 142.374 160.113 116.194 162.401C127.916 137.542 129.737 109.612 121.393 83.4548Z"
          fill="#FFFDFD"
        />

        <Path
          d="M107.442 237.353C69.0349 237.353 37.7887 206.224 37.7887 167.961C37.7887 129.698 69.0349 98.5685 107.442 98.5685C145.849 98.5685 177.095 129.698 177.095 167.961C177.095 206.224 145.849 237.353 107.442 237.353ZM107.442 108.906C74.7568 108.906 48.1649 135.398 48.1649 167.961C48.1649 200.523 74.7568 227.016 107.442 227.016C140.127 227.016 166.719 200.523 166.719 167.961C166.719 135.398 140.127 108.906 107.442 108.906Z"
          fill="#26C242"
        />
        <Path
          d="M107.442 215.945C80.8838 215.945 59.2772 194.419 59.2772 167.961C59.2772 141.502 80.8838 119.976 107.442 119.976C134.001 119.976 155.607 141.502 155.607 167.961C155.607 194.419 134.001 215.945 107.442 215.945ZM107.442 130.314C86.6058 130.314 69.6534 147.202 69.6534 167.961C69.6534 188.72 86.6051 205.608 107.442 205.608C128.279 205.608 145.231 188.72 145.231 167.961C145.231 147.202 128.279 130.314 107.442 130.314Z"
          fill="#26C242"
        />
        <Path
          d="M107.442 189.368C119.31 189.368 128.93 179.784 128.93 167.961C128.93 156.137 119.31 146.553 107.442 146.553C95.5742 146.553 85.9535 156.137 85.9535 167.961C85.9535 179.784 95.5742 189.368 107.442 189.368Z"
          fill="#26C242"
        />

        <Air animatedProps={airAnimation}>
          <Path
            d="M48.3039 48.6295C48.8464 48.6298 49.3824 48.513 49.8754 48.287C50.3683 48.0611 50.8064 47.7314 51.1597 47.3206C52.7403 45.4615 54.0935 43.4212 55.1907 41.2427C55.2993 41.0279 55.3875 40.8032 55.4539 40.5719C55.5526 40.2294 55.656 39.9127 55.7665 39.5773C55.8934 39.1926 56.0227 38.7938 56.1614 38.3152C56.1849 38.2331 56.2037 38.151 56.2225 38.0689C57.2308 33.3774 56.5586 29.0589 54.2787 25.5801L54.2599 25.5496C53.2445 24.0319 52.0528 22.8098 51.0022 21.7331C50.0996 20.8089 49.2488 19.9362 48.6165 18.9979C47.2063 16.8211 47.3356 14.1938 47.7187 12.3313C47.8056 12.0334 47.8973 11.7542 47.996 11.4587C48.0947 11.1631 48.1817 10.8887 48.2804 10.5673C49.074 9.03061 50.0399 7.58888 51.1597 6.26987C51.7938 5.51264 52.1036 4.5366 52.022 3.55308C51.9404 2.56956 51.4739 1.6577 50.7235 1.01494C49.9732 0.372168 48.9993 0.050217 48.0129 0.118789C47.0264 0.187361 46.1067 0.640937 45.4529 1.38131C43.8722 3.2404 42.5191 5.28071 41.4219 7.45917C41.3132 7.67404 41.2251 7.89866 41.1586 8.13005C41.0599 8.47253 40.9565 8.78921 40.8461 9.12465C40.7191 9.50936 40.5898 9.90813 40.4512 10.3867C40.4277 10.4688 40.4089 10.5509 40.3901 10.633C39.3817 15.3245 40.0539 19.643 42.3339 23.1218L42.3527 23.1523C43.368 24.67 44.5597 25.8921 45.6103 26.9688C46.5129 27.893 47.3638 28.7657 47.996 29.704C49.4063 31.8808 49.277 34.5081 48.8939 36.3706C48.8069 36.6685 48.7152 36.9477 48.6189 37.2432C48.5225 37.5388 48.4308 37.8132 48.3345 38.1346C47.5393 39.6709 46.5726 41.1125 45.4529 42.432C44.9845 42.9767 44.6825 43.644 44.5825 44.3548C44.4826 45.0656 44.589 45.79 44.889 46.4423C45.1891 47.0946 45.6703 47.6474 46.2755 48.035C46.8808 48.4227 47.5847 48.629 48.3039 48.6295Z"
            fill="#FFFDFD"
          />
          <Path
            d="M73.0836 48.6294C73.6262 48.6306 74.1625 48.5142 74.6556 48.2882C75.1487 48.0622 75.5867 47.732 75.9393 47.3205C77.3496 45.6784 79.1148 43.4547 80.1184 40.9165C80.4694 40.03 80.7576 39.1199 80.981 38.1931C82.1209 33.6447 81.437 29.1596 79.056 25.5659C78.0406 24.0318 76.8396 22.8073 75.7819 21.7259C74.8793 20.804 74.0238 19.9338 73.4032 18.9978C72.1998 17.1798 71.8802 14.813 72.503 12.3312C72.6454 11.7212 72.8316 11.1223 73.0601 10.539C73.65 9.04242 74.9122 7.47076 75.9464 6.26974C76.2757 5.89687 76.5275 5.46244 76.6872 4.99167C76.8469 4.52089 76.9113 4.02316 76.8767 3.52734C76.8421 3.03152 76.7091 2.5475 76.4856 2.10337C76.262 1.65924 75.9523 1.26384 75.5745 0.940128C75.1966 0.616417 74.758 0.370838 74.2842 0.217644C73.8105 0.06445 73.3109 0.00669248 72.8146 0.0477239C72.3183 0.0887554 71.8351 0.227758 71.3931 0.456665C70.951 0.685572 70.5589 0.999825 70.2396 1.38118C68.8293 3.02321 67.0665 5.24699 66.0629 7.78509C65.7136 8.6716 65.4277 9.58169 65.2073 10.5085C64.065 15.0569 64.7372 19.542 67.13 23.1357C68.1454 24.6698 69.3464 25.8943 70.4041 26.9757C71.309 27.8976 72.1622 28.7679 72.7827 29.7038C73.9861 31.5218 74.3058 33.8887 73.6829 36.3705C73.5413 36.9804 73.3559 37.5793 73.1282 38.1626C72.5359 39.6592 71.2738 41.2309 70.2396 42.4319C69.7716 42.9761 69.4697 43.6428 69.3695 44.3529C69.2693 45.0631 69.375 45.787 69.6743 46.439C69.9735 47.091 70.4536 47.6439 71.0578 48.032C71.662 48.4202 72.365 48.6275 73.0836 48.6294Z"
            fill="#FFFDFD"
          />
          <Path
            d="M97.9316 48.6294C98.4738 48.6303 99.0097 48.5137 99.5024 48.2877C99.995 48.0617 100.433 47.7317 100.785 47.3205C102.195 45.6784 103.96 43.4547 104.964 40.9165C105.313 40.03 105.599 39.12 105.82 38.1931C106.96 33.6447 106.276 29.1596 103.895 25.5659C102.879 24.0318 101.681 22.8073 100.62 21.7259C99.7179 20.804 98.8624 19.9338 98.2442 18.9978C97.0385 17.1798 96.7188 14.813 97.3417 12.3312C97.4841 11.7212 97.6702 11.1223 97.8987 10.539C98.4887 9.04242 99.7508 7.47076 100.785 6.26974C101.114 5.89687 101.366 5.46244 101.526 4.99167C101.685 4.52089 101.75 4.02316 101.715 3.52734C101.681 3.03152 101.548 2.5475 101.324 2.10337C101.101 1.65924 100.791 1.26384 100.413 0.940128C100.035 0.616417 99.5966 0.370838 99.1229 0.217644C98.6491 0.06445 98.1496 0.00669248 97.6533 0.0477239C97.157 0.0887554 96.6738 0.227758 96.2317 0.456665C95.7897 0.685572 95.3976 0.999825 95.0782 1.38118C93.668 3.02321 91.9051 5.24464 90.9015 7.78509C90.5523 8.6716 90.2664 9.58169 90.046 10.5085C88.9037 15.0569 89.5876 19.542 91.9686 23.1357C92.984 24.6698 94.185 25.8943 95.2427 26.9757C96.1476 27.8976 97.0008 28.7679 97.6214 29.7038C98.8248 31.5218 99.1444 33.8887 98.5239 36.3705C98.3804 36.9801 98.1943 37.579 97.9669 38.1626C97.3746 39.6592 96.1124 41.2309 95.0782 42.4319C94.6097 42.9767 94.3076 43.6442 94.2078 44.3552C94.1079 45.0662 94.2145 45.7909 94.5149 46.4433C94.8152 47.0956 95.2968 47.6483 95.9024 48.0358C96.508 48.4233 97.2122 48.6293 97.9316 48.6294Z"
            fill="#FFFDFD"
          />
          <Path
            d="M122.717 48.6295C123.259 48.6304 123.795 48.5138 124.287 48.2878C124.78 48.0618 125.218 47.7318 125.57 47.3206C127.151 45.4615 128.504 43.4212 129.601 41.2427C129.711 41.0283 129.799 40.8036 129.864 40.5718C129.963 40.2294 130.066 39.9127 130.177 39.5772C130.304 39.1925 130.435 38.7938 130.572 38.3152C130.595 38.2331 130.616 38.151 130.633 38.0689C131.644 33.3774 130.971 29.0589 128.691 25.5801L128.67 25.5496C127.655 24.0319 126.463 22.8098 125.413 21.7331C124.512 20.8089 123.659 19.9362 123.029 18.9979C121.619 16.8211 121.746 14.1962 122.129 12.3313C122.218 12.0334 122.31 11.7542 122.406 11.4587C122.503 11.1631 122.592 10.8887 122.691 10.5673C123.486 9.03159 124.452 7.59005 125.57 6.26986C125.907 5.89825 126.165 5.46316 126.331 4.99025C126.496 4.51733 126.565 4.01615 126.533 3.51624C126.502 3.01633 126.37 2.52781 126.146 2.07947C125.922 1.63113 125.611 1.23204 125.23 0.905716C124.849 0.579395 124.407 0.332446 123.929 0.179423C123.451 0.0264007 122.947 -0.0296005 122.447 0.0147218C121.947 0.0590441 121.461 0.202793 121.018 0.437495C120.575 0.672198 120.183 0.993106 119.866 1.38131C118.283 3.23922 116.93 5.27973 115.835 7.45916C115.724 7.67352 115.635 7.89824 115.569 8.13005C115.47 8.47253 115.367 8.7892 115.256 9.12465C115.132 9.50935 115 9.90813 114.864 10.3867C114.84 10.4695 114.819 10.5516 114.8 10.633C113.792 15.3245 114.464 19.643 116.744 23.1218L116.765 23.1523C117.781 24.67 118.972 25.8898 120.023 26.9688C120.923 27.893 121.774 28.7657 122.406 29.704C123.817 31.8808 123.69 34.5057 123.307 36.3706C123.217 36.6685 123.126 36.9477 123.029 37.2432C122.933 37.5388 122.841 37.8132 122.745 38.1346C121.95 39.6703 120.984 41.1118 119.866 42.432C119.397 42.9767 119.095 43.644 118.995 44.3548C118.895 45.0656 119.002 45.79 119.302 46.4423C119.602 47.0946 120.083 47.6473 120.688 48.035C121.294 48.4227 121.998 48.629 122.717 48.6295Z"
            fill="#FFFDFD"
          />
          <Path
            d="M147.569 48.5198C148.112 48.5201 148.648 48.4033 149.141 48.1773C149.634 47.9514 150.072 47.6217 150.425 47.2109C152.006 45.3518 153.359 43.3115 154.456 41.133C154.565 40.9182 154.653 40.6935 154.719 40.4621C154.818 40.1197 154.921 39.803 155.032 39.4675C155.159 39.0828 155.288 38.6841 155.427 38.2055C155.45 38.1234 155.469 38.0413 155.488 37.9592C156.496 33.2677 155.824 28.9492 153.544 25.4704L153.525 25.4399C152.51 23.9222 151.318 22.7001 150.267 21.6234C149.365 20.6992 148.514 19.8265 147.882 18.8882C146.472 16.7114 146.601 14.0841 146.984 12.2216C147.071 11.9237 147.163 11.6445 147.261 11.349C147.36 11.0534 147.447 10.779 147.546 10.4576C148.339 8.92089 149.305 7.47917 150.425 6.16016C151.059 5.40293 151.369 4.42689 151.287 3.44337C151.206 2.45985 150.739 1.54799 149.989 0.905225C149.238 0.262457 148.265 -0.0594936 147.278 0.0090781C146.292 0.0776499 145.372 0.531226 144.718 1.2716C143.138 3.13069 141.784 5.171 140.687 7.34945C140.578 7.56433 140.49 7.78895 140.424 8.02034C140.325 8.36282 140.222 8.6795 140.111 9.01494C139.984 9.39964 139.855 9.79842 139.716 10.277C139.693 10.3591 139.674 10.4412 139.655 10.5233C138.647 15.2148 139.319 19.5333 141.599 23.0121L141.618 23.0426C142.633 24.5603 143.825 25.7824 144.876 26.8591C145.778 27.7833 146.629 28.656 147.261 29.5943C148.672 31.7711 148.542 34.3984 148.159 36.2609C148.072 36.5588 147.98 36.838 147.884 37.1335C147.788 37.4291 147.696 37.7035 147.6 38.0249C146.805 39.5612 145.838 41.0028 144.718 42.3223C144.25 42.867 143.948 43.5343 143.848 44.2451C143.748 44.9559 143.854 45.6803 144.154 46.3326C144.454 46.9849 144.936 47.5376 145.541 47.9253C146.146 48.313 146.85 48.5193 147.569 48.5198Z"
            fill="#FFFDFD"
          />
        </Air>
      </G>
      <Defs>
        <ClipPath id="clip0_282_303">
          <Rect width={222} height={275} fill="white" />
        </ClipPath>
      </Defs>
    </Svg>
  );
};
export default Heater;
