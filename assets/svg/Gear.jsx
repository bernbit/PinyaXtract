import React, { useEffect, useState } from "react";
import Svg, { G, Path, Defs, ClipPath, Rect } from "react-native-svg";
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  useAnimatedProps,
  withRepeat,
  withTiming,
  cancelAnimation,
} from "react-native-reanimated";
import useGlobal from "@/context/GlobalContext";

const Gear = ({ width = 273, height = 213 }) => {
  const { machineState } = useGlobal();

  const gearRotation = useSharedValue(0);
  const GearWheel = Animated.createAnimatedComponent(Path);

  // Rotate gearOne continuously
  useEffect(() => {
    if (machineState) {
      gearRotation.value = 0; // Reset rotation
      gearRotation.value = withRepeat(
        withTiming(360, { duration: 700 }),
        -1,
        false,
      );
    } else {
      gearRotation.value = withTiming(0, { duration: 200 }); // Smooth stop over 500ms
    }
  }, [machineState]);

  const gearOneAnimation = useAnimatedProps(() => ({
    transform: [
      { translateX: 138.405 }, // Move pivot point to the origin
      { translateY: 148.238 },
      { rotate: `${gearRotation.value}deg` }, // Rotate the gear
      { translateX: -138.405 }, // Move pivot point back to its original position
      { translateY: -148.238 },
    ],
  }));

  const gearTwoAnimation = useAnimatedProps(() => ({
    transform: [
      { translateX: 59.31 }, // Move pivot point to the origin
      { translateY: 59.43 },
      { rotate: `${gearRotation.value}deg` }, // Rotate the gear
      { translateX: -59.31 }, // Move pivot point back to its original position
      { translateY: -59.43 },
    ],
  }));

  const gearThreeAnimation = useAnimatedProps(() => ({
    transform: [
      { translateX: 213.629 }, // Move pivot point to the origin
      { translateY: 59.446 },
      { rotate: `${gearRotation.value}deg` }, // Rotate the gear
      { translateX: -213.629 }, // Move pivot point back to its original position
      { translateY: -59.446 },
    ],
  }));

  return (
    <Svg
      width={width}
      height={height}
      viewBox="0 0 273 213"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <G clipPath="url(#clip0_282_293)">
        <G>
          <GearWheel
            animatedProps={gearOneAnimation}
            transform="rotate(0, 138.405, 148.238)"
            fillRule="evenodd"
            clipRule="evenodd"
            d="M199.408 155.913C201.279 155.666 202.674 154.25 202.662 152.376L202.597 142.768C202.585 141.011 201.171 139.615 199.297 139.393L190.394 138.281C189.789 135.356 189.067 132.432 187.995 129.627L195.098 124.19C196.029 123.48 196.607 122.305 196.599 121.25C196.595 120.665 196.474 120.08 196.119 119.496L191.265 111.21C190.435 109.693 188.559 109.119 186.808 109.834L178.523 113.522C176.518 111.193 174.397 109.098 172.043 107.122L175.615 98.7792C175.729 98.3097 175.842 97.8403 175.838 97.2545C175.831 96.0829 175.237 94.9152 174.18 94.3365L165.838 89.5891C164.194 88.6629 162.324 89.1442 161.164 90.6752L155.829 97.8585C153.013 96.823 150.082 96.1398 147.152 95.5738L145.922 86.6775C145.675 84.8045 144.261 83.4081 142.506 83.4199L132.909 83.4848C131.037 83.4975 129.642 84.9129 129.42 86.7891L128.427 95.7004C125.388 96.3068 122.467 97.0296 119.665 98.103L114.233 90.9926C113.053 89.4774 111.177 89.0214 109.662 89.969L101.385 94.8288C100.219 95.4225 99.6414 96.5981 99.6493 97.7697C99.6533 98.3555 99.7735 98.8234 100.011 99.2904L103.578 107.585C101.251 109.593 99.1583 111.716 97.1845 114.073L88.8506 110.497C87.2074 109.805 85.3388 110.403 84.4128 111.933L79.6706 120.284C79.3234 120.872 79.2104 121.458 79.2143 122.044C79.2214 123.099 79.8145 124.266 80.7555 124.963L87.931 130.304C86.8967 133.123 86.2143 136.057 85.6489 138.99L76.7622 140.222C74.8912 140.469 73.6134 141.883 73.6252 143.641L73.6901 153.248C73.7028 155.122 74.9996 156.52 76.8738 156.741L85.7755 157.736C86.3812 160.778 87.1032 163.702 88.1755 166.507L81.0728 171.945C80.1413 172.654 79.5632 173.712 79.5711 174.884C79.5751 175.47 79.6961 176.055 80.0504 176.521L84.9049 184.807C85.8523 186.441 87.7288 187.014 89.3617 186.183L97.6474 182.612C99.6528 184.942 101.774 187.036 104.128 189.012L100.673 197.354C100.442 197.825 100.328 198.294 100.331 198.763C100.34 200.051 100.933 201.219 102.107 201.797L110.449 206.544C111.977 207.471 113.846 206.99 115.006 205.459L120.342 198.276C123.157 199.194 126.088 199.994 129.135 200.56L130.249 209.457C130.495 211.33 131.908 212.609 133.781 212.596L143.378 212.531C145.133 212.52 146.529 211.221 146.75 209.345L147.861 200.433C150.782 199.827 153.703 198.987 156.505 198.031L161.937 205.142C163.118 206.657 164.993 207.113 166.626 206.164L174.903 201.305C175.952 200.712 176.529 199.536 176.52 198.247C176.517 197.779 176.397 197.311 176.277 196.843L172.593 188.549C174.92 186.542 177.012 184.418 178.986 182.062L187.319 185.52C189.08 186.329 190.949 185.73 191.757 184.084L196.499 175.733C196.847 175.262 196.96 174.676 196.956 174.09C196.948 172.918 196.356 171.868 195.415 171.171L188.24 165.83C189.274 163.011 189.956 160.077 190.521 157.027L199.408 155.913ZM138.405 186.671C159.588 186.528 176.792 169.071 176.648 147.748C176.504 126.542 159.066 109.319 137.883 109.462C116.583 109.606 99.379 127.063 99.5222 148.269C99.6662 169.593 117.104 186.815 138.405 186.671Z"
            fill="#30F353"
          />
          <Path
            d="M104.204 148.238C104.33 166.983 119.647 182.111 138.373 181.985C156.981 181.859 172.093 166.525 171.966 147.779C171.84 129.151 156.523 114.023 137.915 114.149C119.189 114.275 104.078 129.609 104.204 148.238Z"
            fill="#2B2B2B"
          />
        </G>

        <G>
          <GearWheel
            animatedProps={gearTwoAnimation}
            transform="rotate(0, 59.31, 59.43)"
            fillRule="evenodd"
            clipRule="evenodd"
            d="M53.8485 13.8058C53.19 12.2862 51.495 11.4148 50.0269 11.8169L43.1383 13.7039C41.5574 14.137 40.6551 15.7199 40.8618 17.3632L41.7091 23.5668C39.9949 24.4006 38.3117 25.3474 36.6903 26.5201L31.7787 22.7656C30.9669 22.0166 29.8269 21.8431 28.8106 22.1215C28.3589 22.2453 27.8251 22.5129 27.4661 22.9755L22.5209 27.973C21.3821 29.1349 21.281 30.9841 22.3603 32.267L26.1329 37.1834C25.1177 38.7972 24.1334 40.524 23.262 42.2198L17.1105 41.4763C16.597 41.3742 16.1144 41.3849 15.6627 41.5087C14.6464 41.7871 13.7845 42.6303 13.498 43.8016L11.717 50.6037C11.2973 52.1758 12.0996 53.7774 13.7329 54.4229L19.4646 56.7384C19.2815 58.7314 19.3242 60.6626 19.4798 62.5628L13.711 64.993C12.1918 65.652 11.4024 67.204 11.835 68.7854L13.72 75.6761C14.1526 77.2576 15.6218 78.1909 17.2646 77.9837L23.4351 77.0219C24.2992 78.8495 25.2453 80.5332 26.4173 82.155L22.6632 87.069C21.5553 88.3439 21.68 90.1311 22.8413 91.2702L27.8669 96.3291C28.6787 97.0781 29.8496 97.3646 30.8659 97.0861C31.3176 96.9624 31.7693 96.8387 32.1593 96.489L37.0438 92.601C38.6877 93.7292 40.4136 94.7136 42.1087 95.585L41.3643 101.739C41.0884 103.393 42.1166 104.933 43.6571 105.239L50.4873 107.132C51.0008 107.235 51.5963 107.193 52.048 107.069C53.0644 106.791 53.9571 106.061 54.3054 105.115L56.5904 99.2679C58.5826 99.4507 60.5131 99.4076 62.4126 99.2515L64.8409 105.022C65.5302 106.655 67.0814 107.444 68.6624 107.011L75.551 105.124C77.0191 104.722 78.0652 103.221 77.8275 101.465L76.8673 95.2919C78.5815 94.4581 80.3777 93.4804 82.03 92.4206L86.8286 96.206C87.7225 96.8112 88.7495 97.0155 89.7658 96.7371C90.3305 96.5825 90.7513 96.3458 91.1412 95.9961L96.1993 90.9677C97.3381 89.8058 97.4393 87.9567 96.36 86.6738L92.4744 81.7882C93.6025 80.1435 94.5868 78.4167 95.4273 76.6079L101.497 77.4953C102.01 77.5975 102.462 77.4737 102.914 77.35C104.043 77.0407 104.905 76.1974 105.109 75.17L106.972 68.224C107.392 66.6519 106.477 65.0812 104.987 64.5178L99.1427 62.2332C99.3258 60.2402 99.2831 58.3091 99.0966 56.2959L104.896 53.9786C106.416 53.3196 107.318 51.7367 106.885 50.1553L105 43.2646C104.568 41.6831 102.986 40.7808 101.343 40.9879L95.1413 41.8367C94.3081 40.1221 93.362 38.4385 92.19 36.8167L96.057 31.8717C97.0211 30.5148 97.0093 28.6966 95.848 27.5576L90.7404 22.6425C90.0106 21.7496 88.8398 21.4632 87.7105 21.7725C87.2588 21.8963 86.838 22.133 86.4481 22.4826L81.5326 26.2577C80.0325 25.2115 78.3066 24.2271 76.4986 23.3867L77.356 17.2019C77.6318 15.5478 76.6037 14.008 75.0322 13.5885L68.1201 11.8392C67.5756 11.624 67.093 11.6348 66.5284 11.7895C65.512 12.0679 64.7322 12.7672 64.3019 13.8565L62.099 19.5599C60.1067 19.3771 58.0633 19.4511 56.1638 19.6072L53.8485 13.8058ZM87.4072 51.7267C83.1738 36.2508 67.065 27.0637 51.5939 31.3017C36.1228 35.5397 26.9358 51.6562 31.1692 67.132C35.4336 82.7208 51.5114 91.795 66.9825 87.557C82.4536 83.319 91.6715 67.3155 87.4072 51.7267Z"
            fill="#30F353"
          />
          <Path
            d="M65.7465 83.0385C78.8461 79.4501 86.4746 66.0677 82.8901 52.9641C79.3365 39.9734 65.9295 32.2318 52.8299 35.8202C39.8433 39.3777 32.1328 52.904 35.6864 65.8946C39.2708 78.9983 52.7598 86.5959 65.7465 83.0385Z"
            fill="#2B2B2B"
          />
        </G>

        <G>
          <GearWheel
            animatedProps={gearThreeAnimation}
            transform="rotate(0, 213.629, 59.446)"
            fillRule="evenodd"
            clipRule="evenodd"
            d="M208.159 13.8219C207.501 12.3023 205.806 11.431 204.338 11.8331L197.449 13.7201C195.868 14.1532 194.966 15.736 195.172 17.3794L196.02 23.5829C194.306 24.4168 192.622 25.3636 191.001 26.5363L186.089 22.7818C185.278 22.0327 184.138 21.8593 183.121 22.1377C182.67 22.2615 182.136 22.5291 181.777 22.9917L176.832 27.9892C175.693 29.1511 175.592 31.0002 176.671 32.2831L180.444 37.1996C179.428 38.8134 178.444 40.5402 177.573 42.236L171.421 41.4925C170.908 41.3903 170.425 41.4011 169.973 41.5249C168.957 41.8033 168.095 42.6465 167.809 43.8178L166.028 50.6199C165.608 52.192 166.41 53.7936 168.044 54.4391L173.775 56.7546C173.592 58.7476 173.635 60.6787 173.79 62.5789L168.022 65.0092C166.502 65.6682 165.713 67.2201 166.146 68.8016L168.031 75.6923C168.463 77.2738 169.932 78.207 171.575 77.9999L177.746 77.0381C178.61 78.8657 179.556 80.5493 180.728 82.1711L176.974 87.0852C175.866 88.3601 175.991 90.1473 177.152 91.2863L182.178 96.3453C182.989 97.0943 184.16 97.3807 185.177 97.1023C185.628 96.9786 186.08 96.8548 186.47 96.5052L191.354 92.6172C192.998 93.7454 194.724 94.7298 196.419 95.6011L195.675 101.755C195.399 103.409 196.427 104.949 197.968 105.255L204.798 107.149C205.311 107.251 205.907 107.209 206.359 107.085C207.375 106.807 208.268 106.077 208.616 105.131L210.901 99.284C212.893 99.4669 214.824 99.4238 216.723 99.2677L219.152 105.038C219.841 106.671 221.392 107.46 222.973 107.027L229.862 105.14C231.33 104.738 232.376 103.237 232.138 101.481L231.178 95.3081C232.892 94.4743 234.688 93.4965 236.341 92.4368L241.139 96.2222C242.033 96.8273 243.06 97.0317 244.076 96.7533C244.641 96.5986 245.062 96.3619 245.452 96.0123L250.51 90.9839C251.649 89.8219 251.75 87.9728 250.671 86.6899L246.785 81.8044C247.913 80.1597 248.898 78.4329 249.738 76.6241L255.807 77.5115C256.321 77.6137 256.773 77.4899 257.224 77.3662C258.354 77.0568 259.215 76.2136 259.42 75.1862L261.283 68.2402C261.703 66.6681 260.787 65.0974 259.298 64.534L253.453 62.2494C253.636 60.2564 253.594 58.3252 253.407 56.3121L259.207 53.9948C260.726 53.3358 261.628 51.7529 261.196 50.1714L259.311 43.2807C258.878 41.6993 257.296 40.797 255.653 41.0041L249.452 41.8529C248.619 40.1383 247.673 38.4547 246.501 36.8329L250.368 31.8879C251.332 30.531 251.32 28.7128 250.159 27.5738L245.051 22.6587C244.321 21.7658 243.15 21.4794 242.021 21.7887C241.569 21.9125 241.149 22.1491 240.759 22.4988L235.843 26.2738C234.343 25.2276 232.617 24.2433 230.809 23.4029L231.667 17.2181C231.942 15.564 230.914 14.0242 229.343 13.6047L222.431 11.8553C221.886 11.6402 221.404 11.651 220.839 11.8056C219.823 12.084 219.043 12.7834 218.613 13.8727L216.41 19.5761C214.417 19.3932 212.374 19.4673 210.474 19.6233L208.159 13.8219ZM241.718 51.7429C237.484 36.267 221.376 27.0799 205.905 31.3179C190.433 35.5559 181.247 51.6723 185.48 67.1482C189.744 82.737 205.822 91.8111 221.293 87.5731C236.764 83.3351 245.982 67.3317 241.718 51.7429Z"
            fill="#30F353"
          />
          <Path
            d="M220.057 83.0546C233.157 79.4663 240.785 66.0839 237.201 52.9802C233.647 39.9896 220.24 32.248 207.141 35.8364C194.154 39.3938 186.443 52.9201 189.997 65.9108C193.582 79.0144 207.07 86.6121 220.057 83.0546Z"
            fill="#2B2B2B"
          />
        </G>
      </G>
      <Defs>
        <ClipPath id="clip0_282_293">
          <Rect width={273} height={213} fill="white" />
        </ClipPath>
      </Defs>
    </Svg>
  );
};
export default Gear;
